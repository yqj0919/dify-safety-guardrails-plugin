# 安全护栏插件

## 中文

### 概述

安全护栏插件是一个AI内容审核和安全过滤系统，旨在防御恶意攻击并确保生成内容的安全合规。这个外部防护系统提供前置审核与后置过滤功能，无需修改底层AI模型。

### 功能特性

- **提示词注入检测**: 识别并阻止潜在的提示词注入攻击，包含7大类：
  - 提示词泄露攻击
  - 敏感数据提取攻击
  - 越狱攻击
  - 反向诱导攻击
  - 资源消耗指令攻击
  - 混淆输入攻击
  - 幻觉诱导攻击
- **内容价值观审核**: 根据《生成式人工智能服务安全基本要求》评估文本内容，包含以下5大维度（31小类）：
  - 违反社会主义核心价值观
  - 歧视性内容
  - 商业违法违规
  - 侵犯他人合法权益
  - 无法满足特定服务类型的安全需求
- **敏感数据检查**: 根据《敏感个人信息处理安全要求》评估文本内容，包含以下8个类别：
  - 生物识别信息泄露
  - 宗教信仰信息泄露
  - 特定身份信息泄露
  - 医疗健康信息泄露
  - 金融账户信息泄露
  - 行踪轨迹信息泄露
  - 不满十四周岁未成年人的个人信息
  - 其他敏感个人信息
- **拦截原因**: 提供详细的拦截原因，包含违规类别、风险等级和建议
- **实时审核**: 实时处理内容并提供即时反馈
- **多语言支持**: 支持多种语言的内容审核
- **灵活集成**: 可集成到Dify框架中，支持agnet、workflow和其他方式。

### 申请 API 密钥 / 访问凭据

新用户如需使用安全护栏API，请按以下方式申请与管理凭据：
- 向 yuanquanjiang@keanbang.com 发送申请邮件，包含您的组织名称、项目描述和预期使用场景。
- 您将在24小时内收到回复，包含您的API访问凭据。
- 若您的部署使用API密钥而非账户凭据，请向管理员申请API密钥，并妥善保管。
- 在Dify插件配置或环境变量中安全存储凭据。参考 `.env.example` 使用：
  - `SAFETY_API_USERNAME`
  - `SAFETY_API_PASSWORD`
- 请确保 `.env` 文件不被提交到版本库（`.gitignore` 已默认忽略）。

### 安装

1. 在您的Dify环境中安装插件：
   - 从Dify插件市场搜索“safety_guardrails”
   - 点击安装按钮将插件添加到您的环境
   ![alt text](image.png)
   ![alt text](image-1.png)
   ![alt text](image-2.png)

2. 配置您的API凭据（用户名和密码）
3. 将安全护栏工具添加到您的工作流中

### 配置

插件需要以下凭据：

- **API用户名**: 您的安全护栏API用户名
- **API密码**: 您的安全护栏API密码

这些凭据安全存储在您的Dify环境中，用于OAuth2身份验证。


### 使用方法

1. 将安全护栏工具添加到您的Dify工作流中
![alt text](image-3.png)
2. 输入您获取到的API用户名、API密码。
3. 在`query`参数中输入要审核的文本内容
![alt text](image-5.png)
4. 工具将返回审核结果。
![alt text](image-6.png)
5. 整体流程框架
![alt text](image-4.png)

### 正确使用指南

为确保安全与合规，推荐以下使用模式：

- 前置审核：在将用户提示词发送给模型前，调用本工具检测提示词注入与敏感数据。
- 后置审核：在模型生成后调用本工具，识别潜在违规并执行安全策略。
- 结果处理：根据返回的 `result` 与违规标记进行分支逻辑。对高风险内容进行拦截、脱敏或引导修改。
- 认证机制：工具会使用您的账户凭据换取短期OAuth2令牌；请求过程会自动处理令牌刷新。
- 错误处理：遇到网络错误或未授权响应时，请核对凭据并重试；记录 `status_code` 与错误详情以便排查。

示例（Dify工作流）：添加安全护栏工具节点，将 `query` 映射自用户输入；依据审核结果进行分支，决定继续生成或阻断并提示用户。


### 系统要求

- Python 3.12+
- Dify插件SDK 0.4.0+
- 用于API通信的网络连接

### 隐私与安全

- 不本地存储用户内容
- 安全的HTTPS/TLS通信
- 基于OAuth2令牌的身份验证
- 仅临时处理数据
- 不与第三方共享数据

### 作者

**yuanquanjiang**

### 版本

0.0.1

### 许可证

请参考项目许可证文件了解许可信息。



